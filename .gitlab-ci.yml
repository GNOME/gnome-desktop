image: fedora:rawhide

variables:
  DEPENDENCIES: gtk3-devel gsettings-desktop-schemas-devel gettext
                gtk-doc xkeyboard-config-devel intltool itstool
                gobject-introspection-devel systemd-devel iso-codes-devel
                libseccomp-devel gcc gcc-c++ glibc-devel gnome-common
                make redhat-rpm-config

build_stable:
  before_script:
    # Work-around https://bugzilla.redhat.com/show_bug.cgi?id=1607172#c4
    - echo "update dnf gdbm" >> translist.txt
    - echo "remove python3-modulemd" >> translist.txt
    - dnf shell -y --nogpgcheck translist.txt
    # Work-around itstool crasher: https://github.com/itstool/itstool/commit/9b84c007a73e8275ca45762f1bfa3ab7c3a852e2
    - rpm -Uvh https://kojipkgs.fedoraproject.org//work/tasks/3068/28763068/itstool-2.0.4-4.fc29.noarch.rpm
    - dnf update -y --nogpgcheck
    - dnf install -y --nogpgcheck $DEPENDENCIES
  script:
    - ./autogen.sh --disable-dependency-tracking
    - make
    - make install
    - make check
